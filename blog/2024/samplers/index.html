<!DOCTYPE html> <html> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Stochastic Samplers: Langevin is Safety Gurarail | RectifiedFlow </title> <meta name="author" content="RectifiedFlow "> <meta name="description" content="Connections between Deterministic and Stochastic Samplers"> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%9B%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://rectifiedflow.github.io/blog/2024/samplers/"> <script src="/assets/js/theme.js?9a0c749ec5240d9cda97bc72359a72c0"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>initTheme();</script> <link defer rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.min.css" integrity="sha256-q9ba7o845pMPFU+zcAll8rv+gC+fSovKsOoNQ6cynuQ=" crossorigin="anonymous"> <link defer rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/styles/github.min.css" integrity="sha256-Oppd74ucMR5a5Dq96FxjEzGF7tTw2fZ/6ksAqDCM8GY=" crossorigin="anonymous" media="screen and (prefers-color-scheme: light)"> <link defer rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/styles/github-dark.min.css" integrity="sha256-nyCNAiECsdDHrr/s2OQsp5l9XeY2ZJ0rMepjCT2AkBk=" crossorigin="anonymous" media="screen and (prefers-color-scheme: dark)"> <link defer rel="stylesheet" href="https://cdn.jsdelivr.net/npm/diff2html@3.4.47/bundles/css/diff2html.min.css" integrity="sha256-IMBK4VNZp0ivwefSn51bswdsrhk0HoMTLc2GqFHFBXg=" crossorigin="anonymous"> <link defer rel="stylesheet" type="text/css" href="https://tikzjax.com/v1/fonts.css"> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/mermaid@10.7.0/dist/mermaid.min.js" integrity="sha256-TtLOdUA8mstPoO6sGvHIGx2ceXrrX4KgIItO06XOn8A=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/d3@7.8.5/dist/d3.min.js" integrity="sha256-1rA678n2xEx7x4cTZ5x4wpUCj6kUMZEZ5cxLSVSFWxw=" crossorigin="anonymous"></script> <script>let mermaidTheme=determineComputedTheme();document.addEventListener("readystatechange",()=>{"complete"===document.readyState&&(document.querySelectorAll("pre>code.language-mermaid").forEach(e=>{const t=e.textContent,d=e.parentElement;d.classList.add("unloaded");let a=document.createElement("pre");a.classList.add("mermaid");const n=document.createTextNode(t);a.appendChild(n),d.after(a)}),mermaid.initialize({theme:mermaidTheme}),"undefined"!=typeof d3&&window.addEventListener("load",function(){d3.selectAll(".mermaid svg").each(function(){var e=d3.select(this);e.html("<g>"+e.html()+"</g>");var t=e.select("g"),d=d3.zoom().on("zoom",function(e){t.attr("transform",e.transform)});e.call(d)})}))});</script> <script src="https://cdn.jsdelivr.net/npm/diff2html@3.4.47/bundles/js/diff2html-ui.min.js" integrity="sha256-eU2TVHX633T1o/bTQp6iIJByYJEtZThhF9bKz/DcbbY=" crossorigin="anonymous"></script> <script>let diff2HtmlTheme=determineComputedTheme();document.addEventListener("readystatechange",()=>{"complete"===document.readyState&&document.querySelectorAll("pre>code.language-diff2html").forEach(e=>{const t=e.textContent,d=e.parentElement;d.classList.add("unloaded");let l=document.createElement("div");l.classList.add("diff2html"),d.after(l),new Diff2HtmlUI(l,t,{colorScheme:diff2HtmlTheme,drawFileList:!0,highlight:!0,matching:"lines"}).draw()})});</script> <script src="https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.min.js" integrity="sha256-MgH13bFTTNqsnuEoqNPBLDaqxjGH+lCpqrukmXc8Ppg=" crossorigin="anonymous"></script> <script>document.addEventListener("readystatechange",()=>{"complete"===document.readyState&&document.querySelectorAll("pre>code.language-geojson").forEach(e=>{const t=e.textContent,a=e.parentElement;a.classList.add("unloaded");let o=document.createElement("div");o.classList.add("map"),a.after(o);var n=L.map(o);L.tileLayer("https://tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'}).addTo(n);let d=L.geoJSON(JSON.parse(t)).addTo(n);n.fitBounds(d.getBounds())})});</script> <script defer src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js" integrity="sha256-0q+JdOlScWOHcunpUk21uab1jW7C1deBQARHtKMcaB4=" crossorigin="anonymous"></script> <script>$(document).ready(function(){var t=null,a=null,e=null,n="";$(".language-chartjs").each(function(){a=$(this),t=$("<canvas></canvas>"),n=a.text(),a.text("").append(t),(e=t.get(0).getContext("2d"))&&n&&new Chart(e,JSON.parse(n))&&a.attr("data-processed",!0)})});</script> <script src="https://cdn.jsdelivr.net/npm/echarts@5.5.0/dist/echarts.min.js" integrity="sha256-QvgynZibb2U53SsVu98NggJXYqwRL7tg3FeyfXvPOUY=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/echarts@5.5.0/theme/dark-fresh-cut.js" integrity="sha256-sm6Ui9w41++ZCWmIWDLC18a6ki72FQpWDiYTDxEPXwU=" crossorigin="anonymous"></script> <script>let echartsTheme=determineComputedTheme();document.addEventListener("readystatechange",()=>{"complete"===document.readyState&&document.querySelectorAll("pre>code.language-echarts").forEach(e=>{const t=e.textContent,a=e.parentElement;a.classList.add("unloaded");let r=document.createElement("div");if(r.classList.add("echarts"),a.after(r),"dark"===echartsTheme)var n=echarts.init(r,"dark-fresh-cut");else n=echarts.init(r);n.setOption(JSON.parse(t)),window.addEventListener("resize",function(){n.resize()})})});</script> <script defer src="https://cdn.jsdelivr.net/npm/vega@5.27.0/build/vega.min.js" integrity="sha256-Yot/cfgMMMpFwkp/5azR20Tfkt24PFqQ6IQS+80HIZs=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/vega-lite@5.16.3/build/vega-lite.min.js" integrity="sha256-TvBvIS5jUN4BSy009usRjNzjI1qRrHPYv7xVLJyjUyw=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/vega-embed@6.24.0/build/vega-embed.min.js" integrity="sha256-FPCJ9JYCC9AZSpvC/t/wHBX7ybueZhIqOMjpWqfl3DU=" crossorigin="anonymous"></script> <script>let vegaTheme=determineComputedTheme();document.addEventListener("readystatechange",()=>{"complete"===document.readyState&&document.querySelectorAll("pre>code.language-vega_lite").forEach(e=>{const t=e.textContent,a=e.parentElement;a.classList.add("unloaded");let d=document.createElement("div");d.classList.add("vega-lite"),a.after(d),"dark"===vegaTheme?vegaEmbed(d,JSON.parse(t),{theme:"dark"}):vegaEmbed(d,JSON.parse(t))})});</script> <script defer src="https://tikzjax.com/v1/tikzjax.js" integrity="sha256-+1qyucCXRZJrCg3lm3KxRt/7WXaYhBid4/1XJRHGB1E=" crossorigin="anonymous"></script> <script src="/assets/js/typograms.js?63f3caa50c7a9624f953b3aec207afa6"></script> <script>document.addEventListener("readystatechange",()=>{"complete"===document.readyState&&document.querySelectorAll("pre>code.language-typograms").forEach(e=>{const t=e.textContent,n=e.parentElement.parentElement;let a=document.createElement("pre");a.classList.add("typogram");const d=create("\n"+t,.3,!1);a.appendChild(d),n.appendChild(a),n.removeChild(e.parentElement)})});</script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?e0514a05c5c95ac1a93a8dfd5249b92e"></script> <script defer src="/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script src="/assets/js/distillpub/template.v2.js"></script> <script src="/assets/js/distillpub/transforms.v2.js"></script> <script src="/assets/js/distillpub/overrides.js"></script> </head> <body> <d-front-matter> <script async type="text/json">
      {
            "title": "Stochastic Samplers: Langevin is Safety Gurarail",
            "description": "Connections between Deterministic and Stochastic Samplers",
            "published": "December 10, 2024",
            "authors": [
              
              {
                "author": "RectifiedFlow Group",
                "authorURL": "mailto:rectifiedflow@googlegroups.com",
                "affiliations": [
                  {
                    "name": "UT Austin",
                    "url": ""
                  }
                ]
              }
              
            ],
            "katex": {
              "delimiters": [
                {
                  "left": "$",
                  "right": "$",
                  "display": false
                },
                {
                  "left": "$$",
                  "right": "$$",
                  "display": true
                }
              ]
            }
          }
    </script> </d-front-matter> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span class="font-weight-bold">RectifiedFlow</span> </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">blog </a> </li> <li class="nav-item"> <button id="search-toggle" title="Search" onclick="openSearchModal()"> <span class="nav-link">ctrl k <i class="ti ti-search"></i></span> </button> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="post distill"> <d-title> <h1>Stochastic Samplers: Langevin is Safety Gurarail</h1> <p>Connections between Deterministic and Stochastic Samplers</p> </d-title> <d-byline></d-byline> <d-article> <d-contents> <nav class="l-text figcaption"> <h3>Contents</h3> <div> <a href="#deterministic-and-stochastic-sampler">Deterministic and Stochastic Sampler</a> </div> <ul> <li> <a href="#why-use-stochastic-sampling">Why use stochastic sampling?</a> </li> <li> <a href="#why-can-a-stochastic-sampler-be-better">Why Can a Stochastic Sampler Be Better?</a> </li> <li> <a href="#example-straight-rectified-flow">Example: Straight Rectified Flow</a> </li> </ul> <div> <a href="#using-different-samplers-in-rectified-flow">Using Different Samplers in Rectified Flow</a> </div> <ul> <li> <a href="#euler-sampler">Euler Sampler</a> </li> <li> <a href="#curved-euler-sampler">Curved Euler Sampler</a> </li> <li> <a href="#sdesampler">SDESampler</a> </li> <li> <a href="#overshootingsampler">OvershootingSampler</a> </li> </ul> </nav> </d-contents> <p>Rectified Flow learns ODE trajectories from the initial distribution $X_0 \sim \pi_0$ to target distribution $X_1 \sim \pi_1$. In the special case where $(X_0, X_1) \sim \pi_0 \times \pi_1$ is an independent coupling and $\pi_0$ is a Gaussian distribution, we can use a <strong>stochastic solver</strong> instead of a deterministic ODE solver during inference. This approach can lead to improved sample quality.</p> <p>In this section, we will introduce how to apply stochastic solvers to rectified flow models. We will: <d-cite key="Liu2022FlowSA"></d-cite></p> <ul> <li>Understand why using a stochastic sampler might sometimes yield better results than a deterministic sampler (like Euler).</li> <li>Understand how to use the different samplers in <a href="https://github.com/lqiang67/rectified-flow" rel="external nofollow noopener" target="_blank">Rectified Flow repo</a> </li> </ul> <h2 id="deterministic-and-stochastic-sampler">Deterministic and Stochastic Sampler</h2> <h3 id="why-use-stochastic-sampling">Why use stochastic sampling?</h3> <p>For rectified flow models, a stochastic sampler sometimes produces better results than a deterministic one. For example, in diffusion models, people find that DDPM (stochastic) works better than DDIM (deterministic) for large-scale text-to-image tasks. Similarly, our <a href="https://arxiv.org/abs/2411.19415" rel="external nofollow noopener" target="_blank">recent work</a> have shown that using a stochastic sampler with rectified flow can improve sample quality, particularly when it comes to rendering complex details like text.</p> <p>Below, we will compare results generated using an Euler sampler (deterministic) and an SDE sampler (stochastic). By visually comparing these results, you can see the qualitative improvements that a stochastic sampler can bring.</p> <div class="l-body"> <img src="/assets/img/euler_sde_compare.png" alt="cross" style="max-width:100%;"> </div> <p>From the visualization above, we see that the Euler samples do not align perfectly with the target distribution $\pi_1$. In contrast, the SDE sampler brings the generated samples closer to $\pi_1$.</p> <h3 id="why-can-a-stochastic-sampler-be-better">Why Can a Stochastic Sampler Be Better?</h3> <p>You might wonder: what makes a stochastic sampler (one that adds randomness at inference) better than a deterministic sampler (one that follows a fixed path)?</p> <p>To understand this, let’s think about <strong>Langevin dynamics</strong>, which is a way of adding small random “pushes” that help samples move in the right direction when evolving from the initial distribution $\pi_0$ to the target distribution $\pi_1$.</p> <p><strong>Key Idea:</strong></p> <p>Rectified flow models learn a <strong>velocity field</strong> $v_t(\cdot)$ that describes how to move points from $\pi_0$ to $\pi_1$. Without noise, we have an ODE:</p> \[d \tilde{Z}_t = v_t(\tilde{Z}_t)dt\] <p>Here:</p> <ul> <li>$\tilde{Z}_t$ is the sample on ODE at time $t$</li> <li>$v_t$ is the learned velocity at time $t$</li> </ul> <p>However, we can also consider a stochastic version by adding a noise-driven term. This leads to an SDE (Stochastic Differential Equation):</p> \[d \tilde{Z}_t = \underbrace{v_t(\tilde{Z}_t)dt}_{\text{Rectified Flow term}} + \underbrace{ \sigma_t^2 \nabla \log \rho_t(\tilde{Z}_t) dt + \sqrt{2} \sigma_t d W_t}_{\text{Langevin dynamics term}},\] <p>Let’s break down the additional terms:</p> <ul> <li> <p>$\rho_t$ is the probability density of the samples at time $t$</p> </li> <li> <p>$\nabla \log \rho_t(\tilde{Z}_t)$ is known as the <strong>score function</strong>. It points in the direction where density is higher. In other words, it tells us how to “correct” the trajectory so that samples move toward higher probability regions of the target distribution.</p> </li> <li> <p>$\sigma_t$ is a noise scale that can vary with time. It controls how strong the random pushes are.</p> </li> <li> <p>$W_t$ represents a Wiener process (or Brownian motion), which is a source of randomness.</p> </li> </ul> <p><strong>What does this achieve?</strong></p> <ul> <li> <p>The <strong>rectified flow term</strong> $v_t(\tilde{Z}_t$ ties to move samples from $\pi_0$ to $\pi_1$ along a smoothly learned path.</p> </li> <li> <p>The <strong>Langevin dynamics term</strong> $\sigma_t^2 \nabla \log \rho_t(\tilde{Z}_t) dt + \sqrt{2} \sigma_t d W_t$ add controlled randomness. The $\nabla \log \rho_t$ term pushes samples toward regions of higher density, while the $d W_t$ term injects noise that preserves the marginal distribution of $\tilde{Z}_t$.</p> </li> </ul> <p>By combining these two effects, the stochastic sampler often finds a better overall solution than a purely deterministic one. It can “correct” the path that samples take, making sure they end up where $\pi_1$ actually has mass, resulting in more accurate and higher-quality samples.</p> <p>Score Function Visualization: In the next toy example, we’ll visualize the score function $\nabla \log \rho_t$. This will help you see how these small corrective forces guide the samples toward the right regions, improving upon what a purely deterministic approach can achieve.</p> <div class="l-body"> <img src="/assets/img/score_function_on_sde_traj.png" alt="cross" style="max-width:100%;"> </div> <p>As shown here, the score function ($\nabla \log \rho_t$) points samples toward regions of higher density. This corrects the trajectories from the original predicted velocity, providing a drifting force that helps ensure samples converge to the most probable areas of the target distribution.</p> <h2 id="use-different-samplers-in-rectified-flow">Use Different Samplers in Rectified Flow</h2> <p>In the Rectified Flow repository, we provide several built-in sampler options. These samplers make it easy to experiment with different ways of generating samples from the learned velocity field. Each sampler follows a different rule for updating particles from the initial distribution $\pi_0$ (a known Gaussian) toward the target distribution $\pi_1$.</p> <h3 id="euler-sampler">Euler Sampler</h3> <p>The <strong>Euler Sampler</strong> is a simple, deterministic method. It updates each sample $X_t$ by moving along the direction of the velocity field $v(X_t, t)$:</p> \[X_{t + \Delta t} = X_t + \Delta t \cdot v(X_t, t)\] <p>This means we are directly integrating the learned velocity field over time.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">rectified_flow.samplers</span> <span class="kn">import</span> <span class="n">EulerSampler</span>

<span class="n">euler_sampler</span> <span class="o">=</span> <span class="nc">EulerSampler</span><span class="p">(</span>
    <span class="n">rectified_flow</span><span class="o">=</span><span class="n">rectflow</span><span class="p">,</span>
    <span class="n">num_steps</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
    <span class="n">num_samples</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">euler_sampler</span><span class="p">.</span><span class="nf">sample_loop</span><span class="p">()</span>

</code></pre></div></div> <div class="l-body"> <img src="/assets/img/euler_sample_result.png" alt="cross" style="max-width:100%;"> </div> <h3 id="curved-euler-sampler">Curved Euler Sampler</h3> <p>The <strong>Curved Euler Sampler</strong> uses interpolation to trace a curved path rather than a straight line. It works as follows:</p> <ul> <li>Starting from the current state $(X_t, t)$</li> <li>Use the velocity model to predict the next velocities and generate two reference points $\hat{X}_0$ and $\hat{X}_1$.</li> <li>Interpolate between $\hat{X}_0$ and $\hat{X}_1$ using functions $\alpha(t)$ and $\beta(t)$ to get the next state:</li> </ul> \[X_{t + \Delta_t} = \alpha(t + \Delta t) \cdot \hat{X}_1 + \beta(t + \Delta t) \cdot \hat{X}_0\] <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">rectified_flow.samplers</span> <span class="kn">import</span> <span class="n">CurvedEulerSampler</span>

<span class="n">curved_euler_sampler</span> <span class="o">=</span> <span class="nc">CurvedEulerSampler</span><span class="p">(</span>
    <span class="n">rectified_flow</span><span class="o">=</span><span class="n">rectflow</span><span class="p">,</span>
    <span class="n">num_steps</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">num_samples</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">curved_euler_sampler</span><span class="p">.</span><span class="nf">sample_loop</span><span class="p">()</span>

</code></pre></div></div> <div class="l-body"> <img src="/assets/img/curved_euler_sample_result.png" alt="cross" style="max-width:100%;"> </div> <h3 id="sdesampler">SDESampler</h3> <p>The SDESampler introduces stochasticity (randomness) into the sampling process. we control the noise at time $t$ using the following hyperparameters:</p> <ul> <li> <p>noise_scale: Controls the amount of noise added at each step.</p> </li> <li> <p>noise_decay_rate: Controls how the noise changes over time. A decay rate of 0 means noise level stays the same, while a decay rate of 1.0 means noise decreases over time.</p> </li> </ul> <p>Mathematically, the effective noise is something like:</p> <p>$\text{Effective Noise at time t} = \text{step_size} * \text{noise_scale} * \beta_t ^ \text{noise_decay_rate}$</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">rectified_flow.samplers</span> <span class="kn">import</span> <span class="n">SDESampler</span>

<span class="n">sde_sampler</span> <span class="o">=</span> <span class="nc">SDESampler</span><span class="p">(</span>
    <span class="n">rectified_flow</span><span class="o">=</span><span class="n">rectflow</span><span class="p">,</span>
    <span class="n">num_steps</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">num_samples</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
    <span class="n">noise_scale</span><span class="o">=</span><span class="mf">15.0</span><span class="p">,</span>      <span class="c1"># Increase noise
</span>    <span class="n">noise_decay_rate</span><span class="o">=</span><span class="mf">0.0</span>   <span class="c1"># Keep noise level constant
</span><span class="p">)</span>

<span class="n">sde_sampler</span><span class="p">.</span><span class="nf">sample_loop</span><span class="p">()</span>
</code></pre></div></div> <div class="l-body"> <img src="/assets/img/sde_sample_result.png" alt="cross" style="max-width:100%;"> </div> <h3 id="overshootingsampler">OvershootingSampler</h3> <p>The OverShootingSampler, introduced in <a href="(https://arxiv.org/abs/2411.19415)">our AMO Sampler paper</a>, adds an extra “overshoot” step during sampling. This means that at each step, it doesn’t just move forward along the trajectory, but goes a bit beyond the next point and then comes back, adding more stochasticity and potentially finding better paths. We can control the amount of noise added by:</p> <ul> <li>c: A parameter controlling how far we overshoot.</li> <li>overshooting_method: Determines the exact method used to overshoot (e.g., “t+dt”).</li> </ul> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">rectified_flow.samplers</span> <span class="kn">import</span> <span class="n">OverShootingSampler</span>


<span class="n">sde_sampler</span> <span class="o">=</span> <span class="nc">OverShootingSampler</span><span class="p">(</span>
  <span class="n">rectified_flow</span><span class="o">=</span><span class="n">rectflow</span><span class="p">,</span>
	<span class="n">num_steps</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
	<span class="n">num_samples</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
  <span class="n">c</span><span class="o">=</span><span class="mf">15.0</span><span class="p">,</span>
  <span class="n">overshooting_method</span><span class="o">=</span><span class="sh">"</span><span class="s">t+dt</span><span class="sh">"</span>
<span class="p">)</span>

<span class="n">sde_sampler</span><span class="p">.</span><span class="nf">sample_loop</span><span class="p">()</span>
</code></pre></div></div> <div class="l-body"> <img src="/assets/img/overshooting_sample_result.png" alt="cross" style="max-width:100%;"> </div> </d-article> <d-appendix> <d-footnote-list></d-footnote-list> <d-citation-list></d-citation-list> </d-appendix> <d-bibliography src="/assets/bibliography/2024-12-10-samplers.bib"></d-bibliography> <div id="giscus_thread" style="max-width: 930px; margin: 0 auto;"> <script>let giscusTheme=determineComputedTheme(),giscusAttributes={src:"https://giscus.app/client.js","data-repo":"RectifiedFlow/RectifiedFlow.github.io","data-repo-id":"","data-category":"Comments","data-category-id":"","data-mapping":"title","data-strict":"1","data-reactions-enabled":"1","data-emit-metadata":"0","data-input-position":"bottom","data-theme":giscusTheme,"data-lang":"en",crossorigin:"anonymous",async:""},giscusScript=document.createElement("script");Object.entries(giscusAttributes).forEach(([t,e])=>giscusScript.setAttribute(t,e)),document.getElementById("giscus_thread").appendChild(giscusScript);</script> <noscript>Please enable JavaScript to view the <a href="http://giscus.app/?ref_noscript" rel="external nofollow noopener" target="_blank">comments powered by giscus.</a> </noscript> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2024 RectifiedFlow . Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. Photos from <a href="https://unsplash.com" target="_blank" rel="external nofollow noopener">Unsplash</a>. </div> </footer> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> <script src="/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script> <script>addBackToTop();</script> <script type="module" src="/assets/js/search/ninja-keys.min.js?a3446f084dcaecc5f75aa1757d087dcf"></script> <ninja-keys hidebreadcrumbs noautoloadmdicons placeholder="Type to start searching"></ninja-keys> <script>let searchTheme=determineComputedTheme();const ninjaKeys=document.querySelector("ninja-keys");"dark"===searchTheme?ninjaKeys.classList.add("dark"):ninjaKeys.classList.remove("dark");const openSearchModal=()=>{const e=$("#navbarNav");e.hasClass("show")&&e.collapse("hide"),ninjaKeys.open()};</script> <script>const ninja=document.querySelector("ninja-keys");ninja.data=[{id:"nav-about",title:"about",section:"Navigation",handler:()=>{window.location.href="/"}},{id:"nav-blog",title:"blog",description:"",section:"Navigation",handler:()=>{window.location.href="/blog/"}},{id:"post-stochastic-samplers-langevin-is-safety-gurarail",title:"Stochastic Samplers: Langevin is Safety Gurarail",description:"Connections between Deterministic and Stochastic Samplers",section:"Posts",handler:()=>{window.location.href="/blog/2024/samplers/"}},{id:"post-all-flows-are-one-flow",title:"All Flows are One Flow",description:"Affine Interpolations Result in Equivalent Rectified Flows",section:"Posts",handler:()=>{window.location.href="/blog/2024/interpolation/"}},{id:"post-rectified-flow-an-introduction",title:"Rectified Flow, An Introduction",description:"A Brief Introduction to the Rectified Flow Model",section:"Posts",handler:()=>{window.location.href="/blog/2024/intro/"}},{id:"socials-email",title:"Send email",section:"Socials",handler:()=>{window.open("mailto:%6C%71%69%61%6E%67@%63%73.%75%74%65%78%61%73.%65%64%75","_blank")}},{id:"socials-google-scholar",title:"Google Scholar",section:"Socials",handler:()=>{window.open("https://scholar.google.com/citations?user=qc6CJjYAAAAJ","_blank")}},{id:"socials-rss",title:"RSS Feed",section:"Socials",handler:()=>{window.open("/feed.xml","_blank")}},{id:"light-theme",title:"Change theme to light",description:"Change the theme of the site to Light",section:"Theme",handler:()=>{setThemeSetting("light")}},{id:"dark-theme",title:"Change theme to dark",description:"Change the theme of the site to Dark",section:"Theme",handler:()=>{setThemeSetting("dark")}},{id:"system-theme",title:"Use system default theme",description:"Change the theme of the site to System Default",section:"Theme",handler:()=>{setThemeSetting("system")}}];</script> <script src="/assets/js/shortcut-key.js?6f508d74becd347268a7f822bca7309d"></script> </body> </html>